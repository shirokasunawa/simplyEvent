
<!doctype html>
<html lang="fr">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js" integrity="sha256-/H4YS+7aYb9kJ5OKhFYPUjSJdrtV6AeyJOtTkw6X72o=" crossorigin="anonymous"></script>
<script src="../../util.js"></script>
<script src="../../content/header.js"></script>
<script src="../../content/footer.js"></script>

<body onload="testConnexion()">
<div id="header"></div>
 <script>
   setHeader()
     </script>
<script>
   let cookie= getCookie('nomuser')
  if( cookie=='' )
  {
    navigation("index.html")
  }
  </script>
  </br>
<span id="essaie"></span>

</body>
<div id="footer"></div>
<script>
  setFooter()
  </script>
<script>
var id= CryptoJS.AES.decrypt(localStorage.getItem("_id"),secretPhrase).toString(CryptoJS.enc.Utf8);
var url = 'http://'+urlDeploy+':3030/events/society/'+id

            const xhr = new XMLHttpRequest()
           
            xhr.open('GET', url, true)
            xhr.setRequestHeader('content-type', 'application/json')
            xhr.setRequestHeader('authorization', 'Bearer 123abc456def')
            xhr.responseType = "json"
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    res = xhr.response;
                    console.log(res)
                 console.log(res["_pubs"].length )
                if(res["_pubs"].length !=0)
                {
                    var string=''
                    for(var t=0; t<res["_pubs"].length ;t++)
                    {
                       string += template(res["_pubs"][t]);
                    }
                    document.getElementById("essaie").innerHTML = string
                }
               else{
                  document.getElementById("essaie").innerHTML = '<p>Na pas de pubs</p>'
               }
                
                }
            };
            xhr.send()
function template(donnee){
    var data=(donnee["img"]["img"]).split(',')[1];
     var binaryBlob = atob(data);
    var s=''
    s +='<div class="row bg-light">'
    s += ' <div class="col"><img class="d-flex justify-content-start" width="500" height="500" src="data:image/jpeg;base64,'+btoa(binaryBlob)+'"></div>'
    //s += ' <div class="col-md-5 p-lg-5 mx-auto my-5">'
    s += '  <div class="col"> <h1 class="display-4 fw-normal d-flex ">Type d\'abonnement : '+donnee["typeAbo"]+'</h1>'
   
     //console.log('Encoded Binary File String:', binaryBlob);
     
/*var img= document.getElementById("myimg")
img.src = 'data:image/jpeg;base64,' + btoa(binaryBlob);*/
    
    if(donnee["typeAbo"]=='emplacement')
    {
        s += ' <p class="lead fw-normal">L\'eplacement : '+donnee["endroit"]+'</p>'
        s += ' <p class="lead fw-normal">Prend fin le  : '+donnee["dateFin"]+'</p>'
    }
    else if(donnee["typeAbo"]=='abonnement')
    {
        s += ' <p class="lead fw-normal">L\'eplacement : '+donnee["endroit"]+'</p>'
        s += ' <p class="lead fw-normal">Prend fin le  : '+donnee["dateFin"]+'</p>'
    }
    else if(donnee["typeAbo"]=='nbrclick')
    {
        s += ' <p class="lead fw-normal">L\'eplacement : '+donnee["endroit"]+'</p>'
        s += ' <p class="lead fw-normal">Nombre de click : '+donnee["nbrClickReel"]+' / '+donnee["nbrClick"]+'</p>'
    }
    s += ' <a class="btn btn-outline-secondary" onclick="supprimepub(\''+donnee["_id"]+'\',\''+donnee["img"]+'\')">supprimer</a>'
   // s +=' </div>'
    
   
    s +=' </div></div></br>'
    return s;
}

function supprimepub(idpub,idphoto)
{
    var url = 'http://'+urlDeploy+':3030/events/pub/'+idpub
const xhr = new XMLHttpRequest()
            
            xhr.open('DELETE', url, true)
            xhr.setRequestHeader('content-type', 'application/json')
            xhr.setRequestHeader('authorization', 'Bearer 123abc456def')
            xhr.responseType = "json"
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    res = xhr.response;
                    console.log(res)
                // console.log(res)
               
                    removePhoto(idphoto)
                }
            };
            xhr.send()
}
function removePhoto(idphoto)
{
    var url = 'http://'+urlDeploy+':3030/events/photo/'+idphoto
const xhr = new XMLHttpRequest()
            
            xhr.open('DELETE', url, true)
            xhr.setRequestHeader('content-type', 'application/json')
            xhr.setRequestHeader('authorization', 'Bearer 123abc456def')
            xhr.responseType = "json"
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    res = xhr.response;
                    //console.log(res)
                // console.log(res)
               
                document.location.reload();
                }
            };
            xhr.send()
}
    </script>

</html>